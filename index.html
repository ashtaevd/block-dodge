<!DOCTYPE html>
<html lang="en">
	<head>

		<title>Block Dodge</title>
		<!-- <meta charset="utf-8"> -->
		<!-- <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"> -->

		<script src="https://aframe.io/releases/0.5.0/aframe.js"></script>
		<script src="https://rawgit.com/andreasplesch/aframe-meshline-component/master/dist/aframe-meshline-component.min.js"></script>
		<script src="https://code.jquery.com/jquery-latest.min.js"></script>

		<script>

		 	

			var levelOneBlocks = [];
			var levelOneNumber = 20;

			// for (var i = 1; i<levelOneNumber + 1; i++) {

			// 	levelOneBlocks.push("levelOneBlock" + i)

			// }

			//creates animation element to be appended to Shape
			function createAnimation(event){

				var anim = document.createElement("a-animation");
				anim.setAttribute("begin", event);
				return anim;

			}

			// var hitColor

		    // ~ ~ ~ block style and behavior ~ ~ ~
		    AFRAME.registerComponent('flying-block', {

				schema: {

				},

				init: function () {
					
          			this.el.setAttribute("geometry", { "primitive": "box" });
         			this.el.setAttribute("material", "color", "#00ffff");
         			this.el.setAttribute("geometry", {"depth": 2, "height": 1, "width": 1} );

         			var position = this.el.getAttribute('position');
         			randomPosition = Math.floor((Math.random() * 20) - 10);
         			this.el.setAttribute('position', { x: randomPosition, y: .5, z: -30 });


					var hitColor = createAnimation("collisionAnim");
					hitColor.setAttribute("attribute", "material.color");
					// hitColor.setAttribute("begin", "collisionAnim");
					hitColor.setAttribute("from", "#00ffff");
					hitColor.setAttribute("to", "#ff0000");
					hitColor.setAttribute("dur", "500");
					hitColor.setAttribute("repeat","2");

					this.el.appendChild(hitColor);

					// var hitScale = createAnimation("collisionAnim2");
					// hitScale.setAttribute("attribute", "scale");
					// hitScale.setAttribute("to", "2, 2, 2");
					// hitScale.setAttribute("dur", "500");

					// this.el.appendChild(hitScale);

					levelOneBlocks.push(this.el);
					
				},

				update: function () {

				},

				tick: function (time, timeDelta) {

					var position = this.el.getAttribute('position');
					var rotation = this.el.getAttribute('rotation');

					this.el.setAttribute('position', { x: position.x , y: position.y, z: position.z + (.006 * timeDelta) });

					if (position.z > 30) {
						this.el.parentNode.removeChild(this.el);
					}

				}

			});	

		    // ~ ~ ~ the originpoint of shooting blocks ~ ~ ~
		    var timeDifference = 800
		    AFRAME.registerComponent('block-creator', {

				schema: {

					// set origin position either here or html

				},

				init: function () {
					
					var self = this;
          			setInterval(function() {

          				//create new flying block with flying-block comonent
          				var entity = document.createElement('a-entity');
          				entity.setAttribute('flying-block', true);
          				self.el.appendChild(entity);

          				//push new block into the array
          				levelOneBlocks.push(entity);

          			}, timeDifference)
					
				},

				update: function () {

					
				},

				tick: function (time, timeDelta) {

					timeDifference -= .1;
					console.log(timeDifference)

				}

			});	


		    // ~ ~ ~ Limiting the player ~ ~ ~

		    // if (self.el.position.x >= 10 || self.el.position.x <= -10 || 
		    // 	self.el.position.z >= 10 || self.el.position.z <= -10) {

		    // 	// canvas background turns red, lose health bar, camera shakes

		    	// else {
		    	// sky white all normal
		    	// }

		    // };

			//***How to limit camera position?***
			// if ( camera.position.x <=-10 || camera.position.x >=10 || camera.position.z <=-10 || camera.position.z >=10 )


			//returns distance between two objects
			function calculateDistance(one, two){

				return Math.sqrt(

					+ Math.pow(one.x-two.x, 2)
					+ Math.pow(one.y-two.y, 2)
					+ Math.pow(one.z-two.z, 2) );

			}

		    function touchLocator(obj, camera){

		        var objPos = obj.getAttribute("position");
		        var camPos = camera.getAttribute("position");
		        
		        if( calculateDistance(objPos, camPos) <= 1.5) {

		        	console.log("Near bloccck.");
		        	obj.emit("collisionAnim", null, false);
		        	// obj.emit("collisionAnim2", null, false);

		        }

		    }

		    function borderLocator(camera){
		        var camPos = camera.getAttribute("position");
		        if( camPos.x >= 9.5 || camPos.x <= -9.5 || 
		    		camPos.z >= 9.5 || camPos.z <= -9.5) {
		        	console.log("Touched the border.");
		        }
		    }

		    // function tracker () {
		    	// console.log("Timer")
				$("document").ready(function() {
		        var scene = document.querySelector('a-scene');
			        // when scene is loaded
			        scene.addEventListener('loaded', function (evt) {
						// if the camera position changes, recalculate distance between camera and objects
						var camera = document.querySelector('a-camera');
						camera.addEventListener('componentchanged', function (evt) {
							if (evt.detail.name === "position") {
								// ~ ~ ~ look through the block array ~ ~ ~
								if(levelOneBlocks.length > 0) {
									for(var i = 0; i < levelOneBlocks.length; i++){
										touchLocator(levelOneBlocks[i], camera);
									}
								}

								borderLocator(camera);

							}
						});
					});
		        });
		    // }

		    // setInterval (tracker(), 500);

	        //while (player.position)

		</script>

	</head>

	<body>

		<a-scene fog="type: linear; color: #FFFFFF; far: 20; near: 10">

			<a-plane color="#ff0000" height="20" width="20" rotation="-90 0 0"></a-plane>
			<a-plane color="#ffffff" height="19" width="19" rotation="-90 0 0" position="0 .01 0"></a-plane>

			<!-- <a-box id="linebox" color="#00FF00" depth:"100" height=".5" width=".5" position="0 1 0"></a-box> -->

			<!-- <a-entity meshline="lineWidth: .2; path: 10 0 100, 10 0 -100; color: #00ffff"></a-entity> -->
			<a-entity floor-lines></a-entity>

			<a-entity block-creator position="0 0 0"></a-entity>

			<a-camera></a-camera>
		
			<!-- <a-entity position = "0 0 40">
				<a-camera></a-camera>
			</a-entity>
 -->
		</a-scene>
		

	</body>
</html>
